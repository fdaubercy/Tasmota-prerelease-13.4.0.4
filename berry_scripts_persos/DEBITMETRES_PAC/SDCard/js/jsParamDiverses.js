<script type='application/javascript'>
    var objTypeGPIO = var objTypeGPIO = "}20'>Aucun}3}265504'>Utilisateur}3}26208'>Option A}3}28448'>Option E}3}232'>Bouton}3}264'>Bouton_n}3}27680'>Bouton_d}3}296'>Bouton_i}3}2128'>Bouton_in}3}27712'>Bouton_id}3}25408'>Bouton_tc}3}2160'>Inter}3}2192'>Inter_n}3}27744'>Inter_d}3}23264'>Rotary A}3}23296'>Rotary B}3}26752'>Rotary A_n}3}26784'>Rotary B_n}3}2224'>Relais}3}2256'>Relais_i}3}29312'>Relais_b}3}29344'>Relais_bi}3}2288'>LED}3}2320'>LED_i}3}2352'>Compteur}3}2384'>Compteur_n}3}2416'>PWM}3}2448'>PWM_i}3}2480'>Buzzer}3}2512'>Buzzer_i}3}2544'>LedLink}3}2576'>LedLink_i}3}27648'>Input}3}27968'>Interrupt}3}23840'>Sortie Hi}3}23872'>Sortie Lo}3}28224'>Heartbeat}3}28256'>Heartbeat_i}3}28736'>Reset}3}2608'>I2C SCl}3}2640'>I2C SDa}3}29376'>I2S MClk}3}27808'>I2S BClk}3}27776'>I2S DOut}3}210528'>I2S DAC}3}27840'>I2S WS}3}27872'>I2S DIn}3}27904'>I2S WS In}3}27936'>I2S BClk In}3}2672'>SPI MISO}3}2704'>SPI MOSI}3}2736'>SPI Clk}3}2768'>SPI CS}3}2800'>SPI DC}3}26720'>CarteSD CS}3}210272'>MCP23Sxx CS}3}28800'>SDIO Cmd}3}28832'>SDIO Clk}3}28864'>SDIO D0}3}28896'>SDIO D1}3}28928'>SDIO D2}3}28960'>SDIO D3}3}2832'>SSPI MISO}3}2864'>SSPI MOSI}3}2896'>SSPI SClk}3}2928'>SSPI CS}3}2960'>SSPI DC}3}27264'>XPT2046 CS}3}2992'>RétroÉcl}3}21024'>Display Rst}3}27616'>EPD Data}3}29184'>TM1621 CS}3}29216'>TM1621 Wr}3}29248'>TM1621 Rd}3}29280'>TM1621 Dat}3}210240'>MCP23xxx Int}3}23200'>Série Tx}3}23232'>Série Rx}3}21184'>DHT11}3}21216'>AM2301}3}21248'>SI7021}3}28768'>MS01}3}21280'>DHT11_o}3}21312'>DS18x20}3}21344'>DS18x20_o}3}25696'>LMT01 Impulsion}3}21376'>WS2812}3}23136'>ALux IrRcv}3}23168'>ALux IrSel}3}23008'>MY92x1 DI}3}23040'>MY92x1 DCkI}3}22912'>SM16716 Clk}3}22944'>SM16716 Dat}3}22976'>SM16716 Pwr}3}24032'>SM2135 Clk}3}24064'>SM2135 Dat}3}29088'>SM2335 Clk}3}29120'>SM2335 Dat}3}29664'>BP1658CJ Clk}3}29696'>BP1658CJ Dat}3}29024'>BP5758D Clk}3}29056'>BP5758D Dat}3}22272'>Tuya Tx}3}22304'>Tuya Rx}3}24640'>MOODL Tx}3}21056'>IR Tx}3}21088'>IR Rx}3}21120'>RF Tx}3}21152'>RF Rx}3}22400'>Capteur RF}3}21856'>SR04 Tri/Tx}3}21888'>SR04 Ech/Rx}3}22048'>TM1638 Clk}3}22080'>TM1638 DIO}3}22112'>TM1638 Stb}3}22176'>HX711 SCk}3}22208'>HX711 Dat}3}22592'>HLWBL Sel}3}22624'>HLWBL Sel_i}3}22656'>HLWBL CF1}3}22688'>HLW8012 CF}3}22720'>BL0937 CF}3}28704'>ADE7880 IRq}3}23456'>ADE7953 IRq}3}29472'>ADE7953 Rst}3}29568'>ADE7953 CS}3}27296'>CSE7761 Tx}3}27328'>CSE7761 Rx}3}23072'>CSE7766 Tx}3}23104'>CSE7766 Rx}3}22752'>MCP39F5 Tx}3}22784'>MCP39F5 Rx}3}22816'>MCP39F5 Rst}3}29984'>NrgMbus Tx Ena}3}21472'>PZEM0XX Tx}3}21504'>PZEM004 Rx}3}21536'>PZEM016 Rx}3}21568'>PZEM017 Rx}3}29504'>NrgMbus Tx}3}29536'>NrgMbus Rx}3}21920'>SDMx20 Tx}3}21952'>SDMx20 Rx}3}21984'>SDM630 Tx}3}22016'>SDM630 Rx}3}23904'>DDS238-2 Tx}3}23936'>DDS238-2 Rx}3}23968'>DDSU666 Tx}3}24000'>DDSU666 Rx}3}28128'>BL0939 Rx}3}25440'>BL0940 Rx}3}28160'>BL0942 Rx}3}25920'>WE517 Tx}3}25952'>WE517 Rx}3}27040'>SDM72 Tx}3}27072'>SDM72 Rx}3}27552'>ZC Pulse}3}28480'>SDM230 Tx}3}28512'>SDM230 Rx}3}21792'>SerBr Tx}3}21824'>SerBr Rx}3}29952'>ModBr Tx Ena}3}29408'>ModBr Tx}3}29440'>ModBr Rx}3}21408'>MHZ Tx}3}21440'>MHZ Rx}3}21600'>SAir Tx}3}21632'>SAir Rx}3}21728'>SDS0X1 Tx}3}21760'>SDS0X1 Rx}3}24320'>HPMA Tx}3}24288'>HPMA Rx}3}21664'>PMS5003 Tx}3}21696'>PMS5003 Rx}3}22144'>MP3 Player}3}29152'>MP3 Busy}3}22848'>PN532 Tx}3}22880'>PN532 Rx}3}23616'>RDM6300 Rx}3}23648'>iBeacon Tx}3}23680'>iBeacon Rx}3}28576'>CM110x Tx}3}28608'>CM110x Rx}3}210336'>LoxO2 RX}3}22496'>MX31855 CS}3}22528'>MX31855 Clk}3}22560'>MX31855 DO}3}23392'>HRE Clk}3}23424'>HRE Dat}3}24096'>Hibernation}3}24608'>HRXL Rx}3}24672'>AS3935}3}27360'>VL53LXX XShut}3}28288'>74x595 SRClk}3}28320'>74x595 RClk}3}28352'>74x595 OE}3}28384'>74x595 Ser}3}24704'>ADC Entrée}3}24736'>ADC Temp.}3}24768'>ADC Lumière}3}24800'>ADC Bouton}3}24832'>ADC Bouton_i}3}24864'>ADC Distance}3}24896'>ADC CT Power}3}23328'>ADC Manette}3}26816'>ADC pH}3}28544'>ADC MQ}3";
	
    /* Crée élements 'option' des balises 'select' */
	function paramFormulaire(jsonData, url) {
		console.log(JSON.parse(jsonData));
		console.log("categorie=" + recupereParamURL('categorie', url));
		
		// Enregistre le json dans balise html
		eb("jsonData").innerHTML = jsonData;
		
		var json = JSON.parse(jsonData).diverses;

		eb("typeESP").value = json.typeESP;
		eb('telePeriod').value = json.telePeriod;
		creeOption('logs', json.logs, "}21'>LOG_LEVEL_ERREUR}3}22'>LOG_LEVEL_INFO}3}23'>LOG_LEVEL_DEBUG}3}24'>LOG_LEVEL_DEBUG_PLUS}3");
		creeOption('eviteResetBTN', json.eviteResetBTN, "}2ON'>ON}3}2OFF'>OFF}3");
		// creeOption('ledPower', json.ledPower, "}2ON'>ON}3}2OFF'>OFF}3");
		// creeOption('ledState', json.ledState, "}20'>Désactivé}3}21'>Affiche l\'état d\'alimentation}3}22'>Clignote si réception MQTT}3}23'>Affiche l\'état d\'alimentation & Clignote si réception MQTT}3}24'>Clignote si émission MQTT}3}25'>Affiche l\'état d\'alimentation & Clignote si émission MQTT}3}26'>Clignote pour tous les messages MQTT}3}27'>Affiche l\'état d\'alimentation & Clignote pour tous les messages MQTT}3}26'>Clignote pour tous les messages MQTT}3}28'>LED allumée lorsque le Wi-Fi et MQTT sont connectés}3");
		// creeOption('ledLink_activation', json.leds.ledLink.activation, "}2ON'>ON}3}2OFF'>OFF}3");
		// eb('ledLink_pin').value = json.leds.ledLink.pin;
		// creeOption('ledLink_type', (json.leds.ledLink.type & 0xffe0) >> 5, objTypeGPIO);
		// creeOption('led1_activation', json.leds.led1.activation, "}2ON'>ON}3}2OFF'>OFF}3");
		// eb('led1_id').value = json.leds.led1.id;
		// eb('led1_pin').value = json.leds.led1.pin;
		// creeOption('led1_type', (json.leds.led1.type & 0xffe0) >> 5, objTypeGPIO);
		
		if (eb('categorie').value == 'localisation') {
			// Initialise le json
			enteteID = "localisation";
			jsonDetail = json[enteteID];

			// Affiche ou efface les fieldsets correspondant aux relais existants
			if (jsonDetail == undefined) {
				if (qs("#fieldset_" + enteteID)) {
					qs("#groupe_" + enteteID).style.display = "none";
					qs("#fieldset_" + enteteID).style.display = "none";
				}
			} else {
				qs("#groupe_" + enteteID).style.display = "block";
				qs("#fieldset_" + enteteID).style.display = "block";

				eb('localisation_latitude').value = jsonDetail.latitude;
				eb('localisation_longitude').value = jsonDetail.longitude;
			}
		} else if (eb('categorie').value == 'fuseauHoraire') {
			// Initialise le json
			enteteID = "fuseauHoraire";
			jsonDetail = json[enteteID];

			// Affiche ou efface les fieldsets correspondant aux relais existants
			if (jsonDetail == undefined) {
				if (qs("#fieldset_" + enteteID)) {
					qs("#groupe_" + enteteID).style.display = "none";
					qs("#fieldset_" + enteteID).style.display = "none";
				}
			} else {
				qs("#groupe_" + enteteID).style.display = "block";
				qs("#fieldset_" + enteteID).style.display = "block";

				eb('fuseauHoraire_timezone').value = jsonDetail.timezone;
				var heures = "}20'>0}3}21'>01}3}22'>02}3}23'>03}3}24'>04}3}25'>05}3}26'>06}3}27'>07}3}28'>08}3}29'>09}3}210'>10}3}211'>11}3}212'>12}3}213'>13}3}214'>14}3}215'>15}3}216'>16}3}217'>17}3}218'>18}3}219'>19}3}220'>20}3}221'>21}3}222'>22}3}223'>23}3";
				creeOption('fuseauHoraire_TimeStd_Hour', jsonDetail.TimeStd.Hour, heures);
				creeOption('fuseauHoraire_TimeDst_Hour', jsonDetail.TimeDst.Hour, heures);

				var days = "}21'>Dimanche}3}22'>Lundi}3}23'>Mardi}3}24'>Mercredi}3}25'>Jeudi}3}26'>Vendredi}27'>Samedi}3";
				creeOption('fuseauHoraire_TimeStd_Day', jsonDetail.TimeStd.Day, days);
				creeOption('fuseauHoraire_TimeDst_Day', jsonDetail.TimeDst.Day, days);

				var months = "}21'>Janvier}3}22'>Février}3}23'>Mars}3}24'>Avril}3}25'>Mai}3}26'>Juin}27'>Juillet}3}28'>Aout}3}29'>Septembre}3}210'>Octobre}3}211'>Novembre}3}212'>Décembre}3";
				creeOption('fuseauHoraire_TimeStd_Month', jsonDetail.TimeStd.Month, months);
				creeOption('fuseauHoraire_TimeDst_Month', jsonDetail.TimeDst.Month, months);

				var weeks = "}20'>Dernière semaine}3}21'>1ère semaine}3}22'>2ème semaine}3}23'>3ème semaine}3}24'>4ème semaine}3";
				creeOption('fuseauHoraire_TimeStd_Week', jsonDetail.TimeStd.Week, weeks);
				creeOption('fuseauHoraire_TimeDst_Week', jsonDetail.TimeDst.Week, weeks);

				var hemispheres = "}20'>Nord}3}21'>Sud}3";
				creeOption('fuseauHoraire_TimeStd_Hemisphere', jsonDetail.TimeStd.Hemisphere, hemispheres);
				creeOption('fuseauHoraire_TimeDst_Hemisphere', jsonDetail.TimeDst.Hemisphere, hemispheres);
				eb('fuseauHoraire_TimeStd_Offset').value = jsonDetail.TimeStd.Offset;
				eb('fuseauHoraire_TimeDst_Offset').value = jsonDetail.TimeDst.Offset;
			}
		}
		
        // Affiche ou efface les fieldsets correspondant au sous module
        document.querySelectorAll('[id^="fieldset_"]').forEach((fieldset) => {
			var categorie = recupereParamURL('categorie', url);
			
			if (recupereParamURL('categorie', url) == "wifi") {categorie = "generale";}

			if (fieldset.id.split("_")[1] == categorie) {
				qs("#groupe_" + enteteID).style.display = "block";
				fieldset.style.display = "block";
				if (categorie == "rangeExtender") {
					qs("#groupe_moduleRangeExtenders").style.display = "block";
					qs('[name="fieldset_moduleRangeExtenders"]').style.display = "block";
				}
            } else {
				if (qs("#groupe_" + fieldset.id.split("_")[1])) {
					qs("#groupe_" + fieldset.id.split("_")[1]).style.display = "none";
					fieldset.style.display = "none";
				}
            }
        });
	}
	/* wl(paramFormulaire); */
	
	/* Prépare la json modifié pour l'envoi en requête POST */
	function prepareJsonPost() {
		var json = JSON.parse(eb("jsonData").innerHTML)["diverses"];	
		var jsonDetail;
		var jsonModifie = {};
		var enteteID = "";
		
		// Pour debug
		console.log("jsonData ->");	console.log(JSON.parse(eb("jsonData").innerHTML));
		console.log("json ->");	console.log(json);	

		// Modifie le json avant envoi par requete POST
		json.typeESP = eb("typeESP").value;
		json.telePeriod = parseInt(eb("telePeriod").value);		
		
		json.logs = parseInt(eb("logs").value);
		json.eviteResetBTN = eb("eviteResetBTN").value;	
		
		if (eb('categorie').value == "localisation") {
			// Initialise le json
			jsonDetail = json.serveur.localisation;			
			
			json.serveur.localisation.latitude = eb('localisation_latitude').value;
			jsonDetail.longitude = eb('localisation_longitude').value;
			
			// Ajoute ou modifie les paramètres du capteur en json
			json.serveur.localisation = jsonDetail;	
		} else if (eb('categorie').value == "fuseauHoraire") {
			// Initialise le json
			jsonDetail = json.serveur.fuseauHoraire;			
			
			jsonDetail.timezone = eb('fuseauHoraire_timezone').value;
			jsonDetail.TimeStd.Hour = eb('fuseauHoraire_TimeStd_Hour').value;
			jsonDetail.TimeDst.Hour = eb('fuseauHoraire_TimeDst_Hour').value;
			jsonDetail.TimeStd.Day = eb('fuseauHoraire_TimeStd_Day').value;
			jsonDetail.TimeDst.Day = eb('fuseauHoraire_TimeDst_Day').value;
			jsonDetail.TimeStd.Month = eb('fuseauHoraire_TimeStd_Month').value;
			jsonDetail.TimeDst.Month = eb('fuseauHoraire_TimeDst_Month').value;
			jsonDetail.TimeStd.Week = eb('fuseauHoraire_TimeStd_Week').value;
			jsonDetail.TimeDst.Week = eb('fuseauHoraire_TimeDst_Week').value;
			jsonDetail.TimeStd.Hemisphere = eb('fuseauHoraire_TimeStd_Hemisphere').value;
			jsonDetail.TimeDst.Hemisphere = eb('fuseauHoraire_TimeDst_Hemisphere').value;
			jsonDetail.TimeStd.Offset = eb('fuseauHoraire_TimeStd_Offset').value;
			jsonDetail.TimeDst.Offset = eb('fuseauHoraire_TimeDst_Offset').value;
				
			// Ajoute ou modifie les paramètres du capteur en json
			json.serveur.fuseauHoraire = jsonDetail;
		}
		
		// json.ledPower = eb("ledPower").value;	
		// json.ledState = parseInt(eb("ledState").value);	
		
		// json.leds.ledLink.activation = eb("ledLink_activation").value;	
		// json.leds.ledLink.pin = parseInt(eb("ledLink_pin").value);	
		// json.leds.ledLink.type = ((eb("ledLink_type").value << 5) & 0xffe0);
		
		// json.leds.led1.activation = eb("led1_activation").value;
		// json.leds.led1.id = parseInt(eb("led1_id").value);	
		// json.leds.led1.pin = parseInt(eb("led1_pin").value);	
		// json.leds.led1.type = ((eb("led1_type").value << 5) & 0xffe0) + json.leds.led1.id - 1;	
		
		// Enregistre le json dans balise html
		jsonModifie["diverses"] = json;
		eb("jsonData").innerHTML = JSON.stringify(jsonModifie);	
	}
</script>